!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6)}([function(t,e,i){"use strict";e.a=function(t={method:method,url:url,data:data,success:success,failure:failure}){let e=t||{};return!!e&&(e.method=e.method||"GET",e.method=e.method.toUpperCase()||"GET",e.url=e.url||"",e.async=e.async||!0,e.data=e.data||{},e.success=e.success||function(){},new Promise((t,i)=>{var s=null;(s=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XHLHTTP")).responseType="json";var n=[];for(let t in e.data)n.push(`${t}=${e.data[t]}`);var o=n.join("&");"GET"===e.method?(n.length>0?s.open(e.method,e.url+"?"+o,e.async):s.open(e.method,e.url,e.async),s.send()):(s.open(e.method,e.url,e.async),s.setRequestHeader("Content-Type","application/json;charset=utf-8"),s.send(JSON.stringify(e.data))),s.onreadystatechange=function(){4==s.readyState&&200==s.status?t(s.response,s):4==s.readyState&&200!==s.status&&i(s.response,s)}}))}},function(t,e,i){"use strict";var s=function(){this.pool={},this.regist=((t,e)=>{this.pool[t]?this.pool.push(e):this.pool[t]=[e]}),this.notify=((t,e=[])=>{this.pool[t]&&this.pool[t].forEach(t=>t(...e))})},n=null;e.a={makeMc:function(){if(n)return new Error("mc already exists");n=new s},getMc:function(){return n||new Error("do not exist mc")}}},function(t,e,i){"use strict";i(3);var s=i(8),n=(i(4),i(9),i(10),i(11),i(0),function(){function t(){this.roomid=String("000000"),this.polling=null,this.cardPool=[],this.players=[],this.banker=new s.a("Banker",this),this.banker.chip=0,this.banker.chippool=0,this.obsPool={},this.state="start",this.stateMap={},this.aBlindChip=4,this.btn=0,this.pos=void 0}return t.prototype.init=function(t){for(let e in t.model)this[e]=t.model[e];this.notifyObs("player"),this.notifyObs("banker"),this.notifyObs("ask"),this.notifyObs("start-btn",this.uid)},t.prototype.regObs=function(t,e){Array.isArray(this.obsPool[t])||(this.obsPool[t]=[]),this.obsPool[t].push(e)},t.prototype.notifyObs=function(t,e=[]){this.obsPool[t].forEach(t=>t(...e))},new t}());e.a=n},function(t,e,i){"use strict";e.a=function(t){return this.key=t,this.cardFace=["A","K","Q","J","10","9","8","7","6","5","4","3","2"],this.typeFace=["♠","♥","♣","♦"],this.val=Number.parseInt(this.key/4),this.type=this.key%4,{cardFace:`${this.typeFace[this.type]} ${this.cardFace[this.val]}`,key:this.key,type:this.type,val:this.val}}},function(t,e,i){"use strict"},function(t,e,i){"use strict";var s=i(12),n=i(0);function o(t){this.model=t,this.view=new s.a(this.model,this),this.polling=null}o.prototype.getData=function(){return Object(n.a)({url:"//localhost:8080/api/v1/room/"+this.model.roomid}).then(t=>t.data?t.data:new Error("get room false")).catch(t=>{})},o.prototype.valid=function(t){t?this.model.validHand(t):this.model.players.forEach(t=>void 0)},o.prototype.init=function(t){this.polling||(this.polling=setInterval(()=>{this.getData().then(t=>{this.model.init(t)})},5e3)),t&&this.model.init(t);let e=this.view.el;e.querySelector(".stage-startBtn").addEventListener("click",()=>{this.start()}),e.querySelectorAll(".stage-select button").forEach(t=>t.addEventListener("click",t=>{this.btnsHandler(t)}))},o.prototype.start=function(){this.model.close(),this.model.init(),this.view.init(),this.view.renderChipField()},o.prototype.startBtnHandler=function(t){var e=this.model,i=this.model.players.find(e=>e.uid==t),s={"001":function(){alert("人数不足")},"002":function(){alert("有人没有准备")}};i.state;if(i.isHost){var o=e.players.every(t=>1==t.isReady||1==t.isHost)?e.players.length<2?"001":void 0:"002";if(o)return s[o]();Object(n.a)({url:`//localhost:8080/api/v1/room/${this.model.roomid}/start`,method:"post"}).then(t=>{t.data&&this.model.init(t.data)}).catch(t=>{alert(t)})}else alert(`player ready => ${i.isReady}`),Object(n.a)({url:`//localhost:8080/api/v1/room/${this.model.roomid}/player/${t}/ready`,method:"post"}).then(t=>{t.data&&this.model.init(t.data)})},o.prototype.back=function(){},o.prototype.btnsHandler=function(t){let e=t.target.getAttribute("data-btn");Object(n.a)({url:`//localhost:8080/api/v1/room/${this.model.roomid}/player/${this.model._uid}/${e}`,method:"post"}),this.view.renderAsk(!0)},o.prototype.addPlayer=function(t){Object(n.a)({url:`//localhost:8080/api/v1/room/${this.model.roomid}/player/${t}`,method:"post"}).catch(t=>{})},o.prototype.delPlayer=function(t){Object(n.a)({url:`//localhost:8080/api/v1/room/${this.model.roomid}/player/${t}`,method:"delete"}).catch(t=>{})},o.prototype.close=function(){this.model._isGaming=!1,clearInterval(this.polling)},o.prototype.start=function(){"start"==this.model.state&&Object(n.a)({url:"//localhost:8080/api/v1/room/"+this.roomid+"/start"}).then(t=>{if(!t.data)return new Error(t.msg);this.model.init(t.data.model)}).catch(t=>{})},e.a=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),n=i(7),o=i(1);o.a.makeMc();var a=o.a.getMc(),r=function(){this.scene=n.a.s_login,this.uid=void 0,this.isLogin=!1,this.init()};r.prototype.init=function(){var t=this;a.regist("sceneSwitch",function(e){t.switchTo(n.a[e])}),a.regist("enterRoom",function(e){Object(s.a)({url:l+"/api/v1/room/"+e}).then(i=>{if(i.data){var s=i.data;0==s.state&&t.scene.control.addPlayer(t.uid),t.scene.model._uid=t.uid,t.scene.model._roomid=e,t.scene.model._isGaming=!1,t.scene.model.init(s.model)}}).catch(t=>void 0)}),a.regist("pressStart",function(){t.scene.control.startBtnHandler(t.uid)}),a.regist("login",function(e){t.uid=e,t.isLogin=!0}),a.regist("back",function(){t.backToLast()});for(let t in n.a)n.a[t].init()},r.prototype.switchTo=function(t,e){this.scene=t,this.scene.use(e)},r.prototype.backToLast=function(){this.scene.close(),this.scene=this.scene.lastScene,this.scene.use()};new r;var l="//localhost:8080"},function(t,e,i){"use strict";var s=i(0),n=i(1),o=i(2),a=i(5),r=(t,e=document)=>e.querySelector(t),l={},c=n.a.getMc();function d({name:t,last:e,el:i,cb:s,fn:n=function(){}}){this.name=t,this.lastScene=e,this.callback=s,this.process=n,this.el=i,function(t){let e=t;l[`s_${e.name}`]=e}(this)}d.prototype.init=function(t){this.callback(t)},d.prototype.close=function(t){this.el.style.display="none"},d.prototype.use=function(t){this.lastScene&&this.lastScene.close(),this.el.style.display="block",this.process(t)},d.prototype.backToLast=function(){if(this.last)return this.close(),this.lastScene.use(),this.lastScene};var h=new d({name:"login",last:null,el:document.querySelector(".login"),cb:function(t){c=n.a.getMc(),r(".back").style.display="none",r("button[type = submit]",this.el).addEventListener("click",()=>{var t=r("#l_uid",this.el).value,e=r("#l_pwd",this.el).value;Object(s.a)({method:"post",url:"//localhost:8080/api/v1/login",data:{uid:Number(t),pwd:e}}).then(e=>{if(200==e.code)return alert("login success"),c.notify("login",[t]),c.notify("sceneSwitch",["s_hall"]),e;alert(e.msg)})}),r("#login_signUp").addEventListener("click",()=>{alert("signUp"),c.notify("sceneSwitch",["s_signUp"])})},fn:()=>{r(".back").style.display="none"}});new d({name:"signUp",last:h,el:document.querySelector(".signUp"),cb:function(){r("#signUp_regist").onclick=function(){var t=r("#s_uid",this.el).value,e=r("#s_pwd",this.el).value,i=r("#s_pwd2",this.el).value;/^[a-zA-Z0-9]{6,12}$/.test(e)?e===i?/^\d{6,12}$/.test(t)?Object(s.a)({method:"post",url:"//localhost:8080/api/v1/signup",data:{uid:Number(t),pwd:e}}).then(t=>{1==t.code&&(alert("注册成功 返回登录界面"),(c=n.a.getMc()).notify("back"))}):alert("账号不合格"):alert("两次密码不一样"):alert("密码非法 需满足 /^[a-zA-Z0-9]{6,12}$/")}},fn:function(){r(".back").style.display="block",r(".back").onclick=function(){c.notify("back")}}});new d({name:"stage",last:new d({name:"hall",last:h,el:r(".hall"),cb:function(t){r(".hall-list").innerHTML=""},fn:function(){r(".back").style.display="block",r(".back").onclick=function(){c.notify("back")};var t={el:r(".hall-list"),isShow:!1,rooms:[]};t.el.innerHTML="";Object(s.a)({url:"//localhost:8080/api/v1/room/"}).then(e=>{e.data?(t.rooms=e.data,t.rooms.forEach(e=>{var i=document.createElement("li");t.el.appendChild(i),function(t,e=[],i,s=(t=>t)){e.forEach(e=>{var n=document.createElement("div");t.appendChild(n),n.innerHTML=i;var o=document.querySelector("div[data-type=cache]")||document.createElement("div");o.setAttribute("data-type","cache"),o.style.display="none",n.appendChild(o);for(let i in e){var a=t.querySelector(s(i));a?a.innerText=e[i]:o.setAttribute(`data-${i}`,e[i])}})}(i,t.rooms,'<div class="hall-room hall-room.waiting">\n\t\t\t\t\t<h2 class="hall-title">title default</h2>\n\t\t\t\t\t<p class="hall-abstract">abstract default</p>\n\t\t\t\t</div>',function(t){return`.hall-${t}`}),t.el.querySelectorAll("li").forEach(t=>{t.addEventListener("click",e=>{var i=t.querySelector("[data-type=cache]").getAttribute("data-id");c.notify("sceneSwitch",["s_stage"]),c.notify("enterRoom",[i])},!1)})})):alert("房间不存在")})}}),el:document.querySelector(".stage"),cb:function(){document.querySelector(".stage-startBtn").addEventListener("click",function(){c.notify("pressStart")}),r(".back").addEventListener("click",function(){this.model._isGaming})},fn:function(t){this.model=o.a,this.control=new a.a(this.model),this.control.init(t)}});e.a=l},function(t,e,i){"use strict";function s(t,e){this.el=null,this.hand=[],this.chip=1e3,this.outChip=0,this.name=t,this.model=e,this.state=3}s.prototype={init:function(){this.hand=[],this.outChip=0},changeChip:function(t){this.chip+=t,this.state=0,this.model.notifyObs("player",this)},addHand:function(t){let e=this.model.cardPool;for(;t>0;t--){let t=e.splice(Math.floor(Math.random()*e.length),1)[0];this.hand.push(t)}this.model.notifyObs("player",this)}},e.a=s},function(t,e,i){"use strict";i(4)},function(t,e,i){"use strict";i(3)},function(t,e,i){"use strict"},function(t,e,i){"use strict";function s(t,e){this.model=t,this.Controllor=e,this.el=document.querySelector(".stage"),this.table=document.querySelector(".stage-table"),this.playerTemplate="<div class=\"player\">\n  \t\t<p class = 'self'>You</p>\n\t\t\t<p class='name'></p><p>剩余筹码:<span\t class='chip'></span></p>\n\t\t\t<p>下注筹码:<span\t class='outChip'></span></p>\n\t\t\t<div class='pokers'></div>\t\n\t\t\t<p>当前牌型:<span\t class='poker-value'></span></p>\t\n\t\t\t</div>",this.bankerTemplate="\n\t\t\t<p class='name'>庄家</p><p>池底:<span\t class='chippool'></span></p>\n\t\t\t<p>当前底注:<span\t class='chip'></span></p>\t\n\t\t\t<div class='pokers'></div>\t\n\t\t\t",this.askTemplate=document.querySelector(".stage-askBlock"),this.model.regObs("banker",this.renderBanker.bind(this)),this.model.regObs("player",this.renderAll.bind(this)),this.model.regObs("ask",this.renderAsk.bind(this)),this.model.regObs("dropChip",this.dropChipAnimate.bind(this)),this.model.regObs("getChip",this.getChipAnimate.bind(this)),this.model.regObs("start-btn",this.renderStartBtn.bind(this))}s.prototype={init:function(){this.table.innerHTML=""},renderBanker:function(){let t=this.model.banker,e=document.querySelector(".stage-banker");e.innerHTML=this.bankerTemplate,e.querySelector(".name").innerText=t.name,e.querySelector(".chippool").innerText=t.chippool,e.querySelector(".chip").innerText=t.chip,"start"!==this.model.state&&(t.hand.sort((t,e)=>t.key-e.key),t.hand.forEach(t=>{let i=document.createElement("span");i.setAttribute("class",`poker-${t.type}`),i.innerText=`${t.cardFace}`,e.querySelector(".pokers").appendChild(i)}))},renderOne:function(t){var e=document.querySelector(`[data-uid=uid${t.uid}]`)||document.createElement("div");e.innerHTML=this.playerTemplate,e.setAttribute("data-uid","uid"+t.uid),t.isHost?e.setAttribute("data-role","host"):e.setAttribute("data-role","guest"),e.setAttribute("data-ready",t.isReady&&0==this.model._isGaming),e.querySelector(".name").innerText=t.name||`u${t.uid}`,e.querySelector(".chip").innerText=t.chip,e.querySelector(".outChip").innerText=t.outChip,t.hand.forEach(t=>{let i=document.createElement("span");i.setAttribute("class",`poker-${t.type}`),i.innerText=`${t.cardFace}`,e.querySelector(".pokers").appendChild(i)}),t.uid==this.model._uid?e.querySelector(".self").setAttribute("data-hide",!1):e.querySelector(".self").setAttribute("data-hide",!0);var i=this.model.players[this.model.pos];i&&(t.uid==i.uid?e.setAttribute("data-cur",!0):e.setAttribute("data-cur",!1));this.model._isGaming,this.model.state;t.el=e,2==t.state?t.el.setAttribute("class","folded"):t.el.removeAttribute("class"),this.el.querySelector(".stage-players").appendChild(t.el)},renderAll:function(){this.renderBanker(),this.model.players.forEach(t=>{this.renderOne(t)})},renderAsk:function(t){var e="turn"==this.model.state,i=this.model._isGaming,s=this.askTemplate||document.querySelector(".stage-askBlock");if(e&&i){if(void 0!=this.model.pos){var n=this.model._uid==this.model.players[this.model.pos].uid;n?s.setAttribute("data-hide",!1):s.setAttribute("data-hide",!0)}}else s.setAttribute("data-hide",!0)},renderStartBtn:function(t){void 0!=t&&(this.model._uid=t);var e=this.model._uid,i=this.model,s=i._isGaming,n=document.querySelector("button[class ~= stage-startBtn]"),o=(i.state,i.players.find(t=>t.uid==e));if(o){var a=o.isHost,r=o.isReady,l={isHost:{true:function(){n.setAttribute("class","stage-startBtn"),n.disabled=!1,n.innerText="点击开始游戏"},false:function(){n.setAttribute("class","stage-startBtn"),n.disabled=!1,n.innerText=r?"取消准备":"准备"}},isGaming:function(){n.setAttribute("class","stage-startBtn stage-startBtn.disable"),n.disabled=!0,n.innerText="游戏中"}};s?(n.setAttribute("data-hide",!0),l.isGaming()):(n.setAttribute("data-hide",!1),l.isHost[a]())}},renderChipField:function(){this.model.players.forEach(t=>{let e=document.createElement("div");e.setAttribute("class","chipField"),t.chipField=e,this.table.appendChild(e)})},dropChipAnimate:function(t){let e=document.createElement("div");e.innerText=t.outChip-t.chipField.innerText;let i=t.el.getBoundingClientRect(),s=this.table.getBoundingClientRect(),n=i.left-s.left,o=s.height/2;e.style.left=n+"px",e.style.top=o+"px",e.setAttribute("class","droppedChip dropping"),t.chipField.appendChild(e)},getChipAnimate:function(t){let e=this.table.querySelectorAll(".droppedChip"),i=t.el.getBoundingClientRect(),s=this.table.getBoundingClientRect(),n=i.left-s.left,o=i.top-s.top;e.forEach(t=>{t.style.left=n+"px",t.style.top=o+"px",t.setAttribute("class","droppedChip getting")})}},e.a=s}]);